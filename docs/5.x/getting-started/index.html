<!doctype html>
<html class="no-js" lang="en-us">

    <head>
    <meta charset="utf-8">
    <title>Agrest - Model-Driven REST Data Services</title>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Open source protocol and Java framework for model-driven REST data services. Works on top of JAX RS and integrates with various backends, such as Apache Cayenne.">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/fav/apple-touch-icon.png">
    <link rel="icon" type="images/png" sizes="32x32" href=" /images/fav/favicon-32x32.png">
    <link rel="icon" type="images/png" sizes="16x16" href=" /images/fav/favicon-16x16.png">
    <link rel="manifest" href= " /images/fav/site.webmanifest">
    <link rel="mask-icon" href=" /images/fav/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href=" /images/fav/favicon.ico">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-config" content=" /images/fav/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <title>agrest - Model-Driven REST Data Services</title>
    <link rel="canonical" href="http://agrest.io" />

    <link href="" rel="stylesheet"><script src="/assets/app.js?69dc993566ef9e10c469"></script>

</head>

    <body data-spy="scroll" data-target=".toc-side" class="cd-head" style="height: 100%; min-height: 100vh; padding-bottom: 70px;">

        
    <nav class="navbar navbar-expand-md navbar-light">
    <div class="container">
        <a class="navbar-brand" href="https://agrest.io/">
            <img src="/images/logo.svg" alt="agrest">
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#mainmenu" aria-controls="mainmenu" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="navbar-collapse collapse" id="mainmenu">
            <div class="navbar-right">
                <ul class="navbar-nav">

    
    <li class="nav-item">
        <a href="/" class="nav-link">Home</a>
    </li>

    <li class="nav-item">
        <a href="/docs/5.x/getting-started/" class="nav-link">Getting Started</a>
    </li>

    <li class="nav-item">
        <a href="/docs/5.x" class="nav-link">Documentation</a>
    </li>

    <li class="nav-item">
        <a href="https://groups.google.com/forum/?#!forum/agrest-user" class="nav-link">Forum</a>
    </li>


</ul>
                <ul class="navbar-nav" id="navbar-social-links">
                    <li class="nav-item"><a href="https://github.com/agrestio/agrest" class="nav-link"><img class="inline-svg icon-svg" src=" /images/fa/fab/github-brands.svg" alt="GitHub"></a></li>
                    <li class="nav-item"><a href="https://twitter.com/AgrestProject" class="nav-link"><img class="inline-svg icon-svg" src=" /images/fa/fab/twitter-brands.svg" alt="Twitter"></a></li>
                </ul>
            </div>
        </div>
    </div> 
</nav>
    <div class="navbar-overlay"></div>
    <div class="documentation-page container content docbook">
        <h1>
            Agrest Getting Started
        </h1>

            <div class="dropdown doc-version">
    <a class="dropdown-toggle" href="#" id="dropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" data-offset="-24,4">
        Version 5.x (development)
    </a>
    <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
            
                <a class="dropdown-item active" href="/docs/5.x/getting-started/">Version 5.x (development)</a>
            
            </div>
</div>

        <hr/>

        <div class="row ">
            <div id="docs-nav" class="col-12 col-lg-4 col-xl-3 nav  docs-nav">
                <div class="tab-content" id="cd-docs-nav">
        <div class="cd-toc-item">
                                <span class="cd-toc-link active">Table of Contents</span><div id="toc" class="toc toc-side"> 
 <div id="toctitle">
  Table of Contents
 </div> 
 <ul class="sectlevel1 nav"> 
  <li><a href="#project-setup" class="nav-link">1. Project Setup</a></li> 
  <li><a href="#orm-mapping" class="nav-link">2. ORM Mapping</a></li> 
  <li><a href="#rest-endpoints" class="nav-link">3. REST Endpoints</a> 
   <ul class="sectlevel2 nav"> 
    <li><a href="#post-create-data" class="nav-link">3.1. POST: Create data</a></li> 
    <li><a href="#rest-app-class" class="nav-link">3.2. REST App Class</a></li> 
    <li><a href="#run-the-app-and-create-data" class="nav-link">3.3. Run the App and Create Data</a></li> 
    <li><a href="#get-select-data" class="nav-link">3.4. GET: Select Data</a></li> 
    <li><a href="#put-update-data" class="nav-link">3.5. PUT: Update Data</a></li> 
   </ul> </li> 
  <li><a href="#custom-property" class="nav-link">4. Custom Property</a></li> 
  <li><a href="#conclusion" class="nav-link">5. Conclusion</a></li> 
 </ul> 
</div></div>
        
        
        
        
        
        
        </div>
            </div>

            <div class="col-12 col-lg-8 col-xl-9  py-3 pl-lg-5">
                <article>
                    <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Through this tutorial we will be building a simple Bookstore REST application using Agrest and a relational database.
Agrest can work with various Java REST API stacks and backends. So there are some choices to make for the
purpose of the tutorial. So we decided to use the following components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SpringBoot / Jersey</p>
</li>
<li>
<p>Derby database</p>
</li>
<li>
<p>Apache Cayenne ORM backend</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We&#8217;ll be using Maven and Java 17 to build and run the project. If you prefer Gradle, it should work as well of course.</p>
</div>
<div class="paragraph">
<p><em>The full code of the tutorial is available
<a href="https://github.com/agrestio/agrest-docs/tree/5.x/agrest-docs-get-started-cayenne-sb">on Github</a>.</em></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="project-setup"><a class="anchor" href="#project-setup"></a>1. Project Setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Letâ€™s start with a new Java Maven project created in your favorite IDE. Once you have a <code>pom.xml</code> file, add a
<code>&lt;dependencyManagement/&gt;</code> section with "BOM" ("Bill of Materials") declarations for Spring Boot and Agrest:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependencyManagement&gt;
    &lt;dependencies&gt;
        &lt;!-- Defines the versions of Agrest modules --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.agrest&lt;/groupId&gt;
            &lt;artifactId&gt;agrest-bom&lt;/artifactId&gt;
            &lt;!-- Replace with a specific 5.x version --&gt;
            &lt;version&gt;${agrest.version}&lt;/version&gt;
            &lt;scope&gt;import&lt;/scope&gt;
            &lt;type&gt;pom&lt;/type&gt;
        &lt;/dependency&gt;

        &lt;!-- Defines the versions of Spring Boot and its dependencies --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt;
            &lt;version&gt;2.6.7&lt;/version&gt;
            &lt;type&gt;pom&lt;/type&gt;
            &lt;scope&gt;import&lt;/scope&gt;
        &lt;/dependency&gt;

        &lt;!-- Defines the version of Derby DB --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.derby&lt;/groupId&gt;
            &lt;artifactId&gt;derby&lt;/artifactId&gt;
            &lt;version&gt;10.14.2.0&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will allow the following <code>&lt;dependencies/&gt;</code> section to include Agrest, Spring and other modules and not
worry about their individual versions. Now let&#8217;s set up the <code>&lt;dependencies/&gt;</code> section:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependencies&gt;

    &lt;!-- This adds Agrest integration for JAX-RS / Jersey 2  --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;io.agrest&lt;/groupId&gt;
        &lt;artifactId&gt;agrest-jaxrs2&lt;/artifactId&gt;
    &lt;/dependency&gt;

    &lt;!-- This adds an Agrest DB backend based on Cayenne ORM --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;io.agrest&lt;/groupId&gt;
        &lt;artifactId&gt;agrest-cayenne&lt;/artifactId&gt;
    &lt;/dependency&gt;

    &lt;!-- Spring Boot + Jersey --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-jersey&lt;/artifactId&gt;
    &lt;/dependency&gt;

    &lt;!-- Simple embedded Java DB --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.apache.derby&lt;/groupId&gt;
        &lt;artifactId&gt;derby&lt;/artifactId&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first two dependencies are Agrest-related, others are SpringBoot and Derby.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="orm-mapping"><a class="anchor" href="#orm-mapping"></a>2. ORM Mapping</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apache Cayenne is a powerful ORM, fully integrated with Agrest. To makes things easier for this tutorial, we will
provide ready-to-use Cayenne ORM model files. And you will generate persistent Java classes from the model with
the CayenneModeler GUI tool.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you want to learn more about Cayenne,
<a href="https://cayenne.apache.org/docs/4.2/getting-started-guide/">here is a link</a> to get started.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following 2 XML files comprise Cayenne mapping project. Copy both of them to the <code>src/main/resources</code> folder:</p>
</div>
<div class="paragraph">
<p>Model file 1: <code>src/main/resources/cayenne-project.xml</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;domain xmlns="http://cayenne.apache.org/schema/10/domain"
	 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	 xsi:schemaLocation="http://cayenne.apache.org/schema/10/domain https://cayenne.apache.org/schema/10/domain.xsd"
	 project-version="10"&gt;
	&lt;map name="datamap"/&gt;
	&lt;node name="datanode"
		 factory="org.apache.cayenne.configuration.server.XMLPoolingDataSourceFactory"
		 schema-update-strategy="org.apache.cayenne.access.dbsync.CreateIfNoSchemaStrategy"&gt;
		&lt;map-ref name="datamap"/&gt;
		&lt;data-source&gt;
			&lt;driver value="org.apache.derby.jdbc.EmbeddedDriver"/&gt;
			&lt;url value="jdbc:derby:target/db;create=true"/&gt;
			&lt;connectionPool min="1" max="5"/&gt;
			&lt;login/&gt;
		&lt;/data-source&gt;
	&lt;/node&gt;
&lt;/domain&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Model file 2: <code>src/main/resources/datamap.map.xml</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;data-map xmlns="http://cayenne.apache.org/schema/10/modelMap"
	 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	 xsi:schemaLocation="http://cayenne.apache.org/schema/10/modelMap https://cayenne.apache.org/schema/10/modelMap.xsd"
	 project-version="10"&gt;
	&lt;property name="defaultPackage" value="io.agrest.tutorial.sb.persistence"/&gt;
	&lt;property name="quoteSqlIdentifiers" value="true"/&gt;
	&lt;db-entity name="author"&gt;
		&lt;db-attribute name="date_of_birth" type="DATE" isMandatory="true"/&gt;
		&lt;db-attribute name="id" type="BIGINT" isPrimaryKey="true" isGenerated="true" isMandatory="true"/&gt;
		&lt;db-attribute name="name" type="VARCHAR" isMandatory="true" length="200"/&gt;
	&lt;/db-entity&gt;
	&lt;db-entity name="book"&gt;
		&lt;db-attribute name="author_id" type="BIGINT" isMandatory="true"/&gt;
		&lt;db-attribute name="id" type="BIGINT" isPrimaryKey="true" isGenerated="true" isMandatory="true"/&gt;
		&lt;db-attribute name="title" type="VARCHAR" isMandatory="true" length="200"/&gt;
	&lt;/db-entity&gt;
	&lt;obj-entity name="Author" className="io.agrest.tutorial.sb.persistence.Author" dbEntityName="author"&gt;
		&lt;obj-attribute name="dateOfBirth" type="java.time.LocalDate" db-attribute-path="date_of_birth"/&gt;
		&lt;obj-attribute name="name" type="java.lang.String" db-attribute-path="name"/&gt;
	&lt;/obj-entity&gt;
	&lt;obj-entity name="Book" className="io.agrest.tutorial.sb.persistence.Book" dbEntityName="book"&gt;
		&lt;obj-attribute name="title" type="java.lang.String" db-attribute-path="title"/&gt;
	&lt;/obj-entity&gt;
	&lt;db-relationship name="books" source="author" target="book" toMany="true"&gt;
		&lt;db-attribute-pair source="id" target="author_id"/&gt;
	&lt;/db-relationship&gt;
	&lt;db-relationship name="author" source="book" target="author"&gt;
		&lt;db-attribute-pair source="author_id" target="id"/&gt;
	&lt;/db-relationship&gt;
	&lt;obj-relationship name="books" source="Author" target="Book" deleteRule="Deny" db-relationship-path="books"/&gt;
	&lt;obj-relationship name="author" source="Book" target="Author" deleteRule="Nullify" db-relationship-path="author"/&gt;
	&lt;cgen xmlns="http://cayenne.apache.org/schema/10/cgen"&gt;
		&lt;destDir&gt;../java&lt;/destDir&gt;
		&lt;mode&gt;entity&lt;/mode&gt;
		&lt;template&gt;templates/v4_1/subclass.vm&lt;/template&gt;
		&lt;superTemplate&gt;templates/v4_1/superclass.vm&lt;/superTemplate&gt;
		&lt;template&gt;templates/v4_1/subclass.vm&lt;/template&gt;
		&lt;superTemplate&gt;templates/v4_1/superclass.vm&lt;/superTemplate&gt;
		&lt;embeddableTemplate&gt;templates/v4_1/embeddable-subclass.vm&lt;/embeddableTemplate&gt;
		&lt;embeddableSuperTemplate&gt;templates/v4_1/embeddable-superclass.vm&lt;/embeddableSuperTemplate&gt;
		&lt;queryTemplate&gt;templates/v4_1/datamap-subclass.vm&lt;/queryTemplate&gt;
		&lt;querySuperTemplate&gt;templates/v4_1/datamap-superclass.vm&lt;/querySuperTemplate&gt;
		&lt;outputPattern&gt;*.java&lt;/outputPattern&gt;
		&lt;makePairs&gt;true&lt;/makePairs&gt;
		&lt;usePkgPath&gt;true&lt;/usePkgPath&gt;
		&lt;overwrite&gt;false&lt;/overwrite&gt;
		&lt;createPropertyNames&gt;false&lt;/createPropertyNames&gt;
		&lt;createPKProperties&gt;false&lt;/createPKProperties&gt;
		&lt;client&gt;false&lt;/client&gt;
	&lt;/cgen&gt;
&lt;/data-map&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s generate persistent Java classes from the ORM model:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://cayenne.apache.org/docs/4.2/cayenne-guide/#runModeler">Download CayenneModeler GUI and open it on your computer</a>.
For this tutorial you will need the latest version of the Modeler <code>4.2</code>.</p>
</li>
<li>
<p>Open <code>cayenne-project.xml</code> in the Modeler.</p>
</li>
<li>
<p>Expand the project tree on the left, navigating to <code>project</code> &gt; <code>datamap</code>, and select <code>Class Generation</code> tab on the
right:</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../img/getting-started/cgen.png" alt="cgen">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Make sure the <code>Output Directory</code> field points to your <code>src/main/java</code> folder, and then click the <code>Generate</code> button.</p>
</li>
<li>
<p>If everything went well, you should see 4 Java classes generated under <code>src/main/java/io/agrest/tutorial/sb/persistence</code>,
that represent our persistent entities:</p>
<div class="ulist">
<ul>
<li>
<p><code>auto/_Author.java</code></p>
</li>
<li>
<p><code>auto/_Book.java</code></p>
</li>
<li>
<p><code>Author.java</code></p>
</li>
<li>
<p><code>Book.java</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="rest-endpoints"><a class="anchor" href="#rest-endpoints"></a>3. REST Endpoints</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="post-create-data"><a class="anchor" href="#post-create-data"></a>3.1. POST: Create data</h3>
<div class="paragraph">
<p>Let&#8217;s write a couple of POST endpoints to allow users to create Authors and Books. We&#8217;ll start by creating Java classes
<code>AuthorApi</code> and <code>BookApi</code>, placing a few JAX-RS annotations on them, and injecting JAX-RS <code>Configuration</code> object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Path("author")
@Produces(MediaType.APPLICATION_JSON)
@Consumes(MediaType.APPLICATION_JSON)
public class AuthorApi {

    @Context
    private Configuration config;
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Path("book")
@Produces(MediaType.APPLICATION_JSON)
@Consumes(MediaType.APPLICATION_JSON)
public class BookApi {

    @Context
    private Configuration config;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s create POST methods in both classes. In <code>AuthorApi</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@POST
public DataResponse&lt;Author&gt; create(@Context UriInfo uri, String data) {
    return AgJaxrs.create(Author.class, config) <i class="conum" data-value="1"></i><b>(1)</b>
            .clientParams(uri.getQueryParameters()) <i class="conum" data-value="2"></i><b>(2)</b>
            .syncAndSelect(data); <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Start a builder for "create" operation. <code>config</code> parameter passed to <code>create(..)</code>, contains Agrest runtime</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Pass URL parameters. This will control the shape of the response</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Execute create operation and return created Author to the client</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In <code>BookApi</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@POST
public SimpleResponse create(String data) {
    return AgJaxrs.create(Book.class, config).sync(data);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice the difference between Author and Book POST methods. In the former case, after creating an object
Agrest returns <code>DataResponse&lt;Author&gt;</code>, allowing the client to inspect the result of the operation (e.g. obtain the
Author&#8217;s ID generated by the server). In the latter case, it returns <code>SimpleResponse</code> that does not contain any data.</p>
</div>
</div>
<div class="sect2">
<h3 id="rest-app-class"><a class="anchor" href="#rest-app-class"></a>3.2. REST App Class</h3>
<div class="paragraph">
<p>Now that we have a few endpoint, how do we integrate them in our app? Let&#8217;s create a main class of our SpringBoot
application called <code>AgrestApp</code> with some bootstrap code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@SpringBootApplication
public class AgrestApp extends ResourceConfig { <i class="conum" data-value="1"></i><b>(1)</b>

    public static void main(String[] args) {
        SpringApplication application = new SpringApplication(AgrestApp.class);
        application.setBannerMode(Banner.Mode.OFF);
        application.run(args);
    }

    public AgrestApp() {

        <i class="conum" data-value="2"></i><b>(2)</b>
        ServerRuntime cayenneRuntime = ServerRuntime
                .builder()
                .addConfig("cayenne-project.xml")
                .build();

        <i class="conum" data-value="3"></i><b>(3)</b>
        AgCayenneModule agCayenneBackend = AgCayenneBuilder.build(cayenneRuntime);
        AgRuntime agRuntime = AgRuntime.builder().module(agCayenneBackend).build();

        <i class="conum" data-value="4"></i><b>(4)</b>
        AgJaxrsFeature agFeature = AgJaxrsFeature.build(agRuntime);
        register(agFeature);

        <i class="conum" data-value="5"></i><b>(5)</b>
        register(AuthorApi.class);
        register(BookApi.class);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Our app class extends <code>ResourceConfig</code> coming from Jersey (our JAX-RS provider). Jersey configuration normally
happens in the <code>ResourceConfig</code> constructor (as described below), and the <code>ResourceConfig</code> is then automatically loaded
by SpringBoot on startup.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create Cayenne runtime</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create Agrest runtime with Cayenne backend</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Register Agrest runtime with Jersey / JAX-RS environment</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Register API endpoints with Jersey</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="run-the-app-and-create-data"><a class="anchor" href="#run-the-app-and-create-data"></a>3.3. Run the App and Create Data</h3>
<div class="paragraph">
<p>Now we can run the main class in the IDE, and use <code>curl</code> or a similar HTTP client to create some data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">curl -X POST -i \
  -d '{"name":"Ernest Hemingway","dateOfBirth":"1899-07-21"}' \
  -H 'Content-Type: application/json' \
  http://localhost:8080/author</code></pre>
</div>
</div>
<div class="paragraph">
<p>The response might look like this (note the id value, we&#8217;ll need it to create Books) :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>HTTP/1.1 201
Content-Type: application/json
Content-Length: 55
Date: Sat, 14 May 2022 09:39:39 GMT</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{"data":[{"id":1,"dateOfBirth":"1899-07-21","name":"Ernest Hemingway"}],"total":1}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s create a <code>Book</code>. In the following POST request, use the ID of the author from the previous call:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">curl -X POST -i \
  -d '[{"title":"A Farewell to Arms","author":1},{"title":"For Whom the Bell Tolls","author":1}]' \
  -H 'Content-Type: application/json' \
  http://localhost:8080/book</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since <code>BookApi</code> used <code>SimpleResponse</code>, the JSON returned will be just an acknowledgement of success:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>HTTP/1.1 201
Content-Type: application/json
Content-Length: 16
Date: Sat, 14 May 2022 09:43:01 GMT</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{"success":true}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="get-select-data"><a class="anchor" href="#get-select-data"></a>3.4. GET: Select Data</h3>
<div class="paragraph">
<p>Now that we have some data in the DB, let&#8217;s build an endpoint to retrieve it via <code>GET</code> requests. In <code>BookApi</code> add
the following method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@GET
public DataResponse&lt;Book&gt; get(@Context UriInfo uriInfo) {
    return AgJaxrs.select(Book.class, config)
            .clientParams(uriInfo.getQueryParameters())
            .get();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you can restart the app, and run the  following request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">curl http://localhost:8080/book</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "data":[
    {"id":1,"title":"A Farewell to Arms"},
    {"id":2,"title":"For Whom the Bell Tolls"}
  ],
  "total":2
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since we passed all URL parameters directly to Agrest (via <code>clientParams(uriInfo.getQueryParameters())</code>), we can
pass various Agrest protocol keys in the URL, to filter the result, resolve related objects, etc. Some examples:</p>
</div>
<div class="paragraph">
<p>Include Author in the response, and exclude ids:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">curl 'http://localhost:8080/book?exclude=id&amp;include=author.name'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "data":[
    {"author":{"name":"Ernest Hemingway"},"title":"For Whom the Bell Tolls"},
    {"author":{"name":"Ernest Hemingway"},"title":"A Farewell to Arms"}
  ],
  "total":2
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sort by title:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">curl 'http://localhost:8080/book?include=title&amp;sort=title'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "data":[
    {"title":"A Farewell to Arms"},
    {"title":"For Whom the Bell Tolls"}
  ],
  "total":2}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="put-update-data"><a class="anchor" href="#put-update-data"></a>3.5. PUT: Update Data</h3>
<div class="paragraph">
<p>Similar to how we implemented <code>POST</code>, you can also write <code>PUT</code> endpoints. We are leaving it as an exercise for the
reader, but here are some hints:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>PUT</code> requires an <code>id</code> attribute to be present for each object in the request payload.</p>
</li>
<li>
<p>You would need to use <code>AgJaxrs.update(..)</code> method to process the request.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
PUT can be used not only for updates, but also for "create-or-update" operations. Agrest has
special methods for those: <code>AgJaxrs.createOrUpdate(..)</code>, <code>AgJaxrs.idempotentCreateOrUpdate(..)</code>, etc. Those work with objects
that have <a href="https://en.wikipedia.org/wiki/Natural_key">natural keys</a> understood by the client. This is not directly
applicable to our Book and Author entities, though with a bit of a stretch we can use <code>Author.name</code> property as
a natural key.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="custom-property"><a class="anchor" href="#custom-property"></a>4. Custom Property</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Agrest has a powerful API for building REST entity schemas, but so far we didn&#8217;t have to interact with it.
Agrest simply took the existing model from Cayenne and exposed each ORM entity as a REST entity. In reality, REST
entities often look very different from persistent objects, and there are various mechanisms to define their structure
and retrieval strategy. Here we will show the simplest way to define a new property in an existing entity.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s imagine we would like to add the <code>age</code> property to the <code>Author</code> object. This is not a persistent property, and
is not known to Cayenne. Yet, it is rather easy to calculate from the current date and the <code>Author.dateOfBirth</code>
property. So we can write a getter method on the Author that performs such calculation. We will use a special
<code>@AgAttribute</code> annotation to tell Agrest that the new property is a part of the REST model:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@AgAttribute
public int getAge() {
    return Period.between(getDateOfBirth(), LocalDate.now()).getYears();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s restart the app, and run the following request for books with authors and their ages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">curl 'http://localhost:8080/book?exclude=id&amp;include=author.name&amp;include=author.age'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "data":[
    {"author":{"age":122,"name":"Ernest Hemingway"},"title":"For Whom the Bell Tolls"},
    {"author":{"age":122,"name":"Ernest Hemingway"},"title":"A Farewell to Arms"}
  ],
  "total":2
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can see that as of this writing, Hemingway was 122 years old. <code>@AgAttribute</code> on getters is not the only
way to add custom properties, bit it is very handy for simple calculated properties like our example.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conclusion"><a class="anchor" href="#conclusion"></a>5. Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This concludes our tutorial. From here you should check the <a href="../protocol">"Protocol" document</a> on how to interact
with Agrest from the client, and the <a href="../framework">"Server Framework" document</a> for an in-depth discussion of how
to write model-driven endpoints with user-specific schemas, security controls, a variety of backends, etc.</p>
</div>
</div>
</div>
                </article>
            </div>

        </div>
    </div>


        <footer id="footer" class="pt-0 pb-3" style ="bottom: 0px; position: absolute; width: 100%;">
    <div class="container">
        <div class="row justify-content-center text-center">
            <div class="col-8 col-md-12">
                <p class="text-muted">&copy;  <span class="current-year">2018</span> ObjectStyle and other Agrest Developers.</p>
                <ul id="social-icons" class="list-unstyled list-inline  mb-0">
                    <li class="list-inline-item">
                        <a href="https://github.com/agrestio/agrest">
                            <img class="inline-svg" src="/images/fa/fab/github-brands.svg" alt="github logo"/>
                        </a>
                    </li>
                    <li class="list-inline-item">
                        <a href="https://twitter.com/AgrestProject">
                            <img class="inline-svg" src="/images/fa/fab/twitter-brands.svg" alt="twitter logo"/>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</footer>

    </body>
</html>
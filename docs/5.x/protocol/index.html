<!doctype html>
<html class="no-js" lang="en-us">

    <head>
    <meta charset="utf-8">
    <title>Agrest - Model-Driven REST Data Services</title>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Open source protocol and Java framework for model-driven REST data services. Works on top of JAX RS and integrates with various backends, such as Apache Cayenne.">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/fav/apple-touch-icon.png">
    <link rel="icon" type="images/png" sizes="32x32" href=" /images/fav/favicon-32x32.png">
    <link rel="icon" type="images/png" sizes="16x16" href=" /images/fav/favicon-16x16.png">
    <link rel="manifest" href= " /images/fav/site.webmanifest">
    <link rel="mask-icon" href=" /images/fav/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href=" /images/fav/favicon.ico">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-config" content=" /images/fav/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <title>agrest - Model-Driven REST Data Services</title>
    <link rel="canonical" href="http://agrest.io" />

    <link href="" rel="stylesheet"><script src="/assets/app.js?84b3cd075cdb0ce3851b"></script>

</head>

    <body data-spy="scroll" data-target=".toc-side" class="cd-head" style="height: 100%; min-height: 100vh; padding-bottom: 70px;">

        
    <nav class="navbar navbar-expand-md navbar-light">
    <div class="container">
        <a class="navbar-brand" href="https://agrest.io/">
            <img src="/images/logo.svg" alt="agrest">
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#mainmenu" aria-controls="mainmenu" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="navbar-collapse collapse" id="mainmenu">
            <div class="navbar-right">
                <ul class="navbar-nav">

    
    <li class="nav-item">
        <a href="/" class="nav-link">Home</a>
    </li>

    <li class="nav-item">
        <a href="/docs/5.x/getting-started/" class="nav-link">Getting Started</a>
    </li>

    <li class="nav-item">
        <a href="/docs/5.x" class="nav-link">Documentation</a>
    </li>

    <li class="nav-item">
        <a href="https://groups.google.com/forum/?#!forum/agrest-user" class="nav-link">Forum</a>
    </li>


</ul>
                <ul class="navbar-nav" id="navbar-social-links">
                    <li class="nav-item"><a href="https://github.com/agrestio/agrest" class="nav-link"><img class="inline-svg icon-svg" src=" /images/fa/fab/github-brands.svg" alt="GitHub"></a></li>
                    <li class="nav-item"><a href="https://twitter.com/AgrestProject" class="nav-link"><img class="inline-svg icon-svg" src=" /images/fa/fab/twitter-brands.svg" alt="Twitter"></a></li>
                </ul>
            </div>
        </div>
    </div> 
</nav>
    <div class="navbar-overlay"></div>
    <div class="documentation-page container content docbook">
        <h1>
            Agrest Protocol
        </h1>

            <div class="dropdown doc-version">
    <a class="dropdown-toggle" href="#" id="dropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" data-offset="-24,4">
        Version 5.x (development)
    </a>
    <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
            
                <a class="dropdown-item active" href="/docs/5.x/protocol/">Version 5.x (development)</a>
            
            
                <a class="dropdown-item " href="/docs/4.x/protocol/">Version 4.x (stable)</a>
            </div>
</div>

        <hr/>

        <div class="row ">
            <div id="docs-nav" class="col-12 col-lg-4 col-xl-3 nav  docs-nav">
                <div class="tab-content" id="cd-docs-nav">
        
        
        
        
        <div class="cd-toc-item">
                                <span class="cd-toc-link active">Table of Contents</span><div id="toc" class="toc toc-side"> 
 <div id="toctitle">
  Table of Contents
 </div> 
 <ul class="sectlevel1 nav"> 
  <li><a href="#overview" class="nav-link">1. Overview</a></li> 
  <li><a href="#json-documents" class="nav-link">2. JSON Documents</a> 
   <ul class="sectlevel2 nav"> 
    <li><a href="#simple-document" class="nav-link">2.1. Simple Document</a></li> 
    <li><a href="#Collection_Document" class="nav-link">2.2. Collection Document</a></li> 
    <li><a href="#update-document" class="nav-link">2.3. Update Document</a></li> 
   </ul> </li> 
  <li><a href="#dates-and-times" class="nav-link">3. Dates and Times</a></li> 
  <li><a href="#control-parameters" class="nav-link">4. Control Parameters</a> 
   <ul class="sectlevel2 nav"> 
    <li><a href="#exp" class="nav-link">4.1. exp</a></li> 
    <li><a href="#sort-dir" class="nav-link">4.2. sort / dir</a></li> 
    <li><a href="#Pagination" class="nav-link">4.3. start / limit</a></li> 
    <li><a href="#mapby" class="nav-link">4.4. mapBy</a></li> 
    <li><a href="#include-exclude" class="nav-link">4.5. include / exclude</a></li> 
   </ul> </li> 
 </ul> 
</div></div>
        
        
        </div>
            </div>

            <div class="col-12 col-lg-8 col-xl-9  py-3 pl-lg-5">
                <article>
                    <div class="sect1">
<h2 id="overview"><a class="anchor" href="#overview"></a>1. Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Agrest Protocol is a simple HTTP/JSON-based message protocol. It operates on an object
model implicitly shared between a client and a server. It defines the format of JSON
documents exchanged between client and server, and a set of control parameters that let the
client control representation of the model returned from the server. E.g. the client may
request a range of objects, sorted in a specific order, matching a criteria, with each
object including a subset of attributes and related entities. This gives the client exactly
what it needs, thus simplifying the code, minimizing the number of trips to the server, and
optimizing the size of the response.</p>
</div>
<div class="paragraph">
<p>Content type of <code>application/json</code> is used in both requests and responses where applicable.
Values of some control parameters below are also represented as JSON.</p>
</div>
<div class="paragraph">
<p>All examples below use a data model for an imaginary CMS made of 2 entities: Domain
and Article, with a 1-to-N relationship between them:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../img/protocol/model.png" alt="model">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="json-documents"><a class="anchor" href="#json-documents"></a>2. JSON Documents</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="simple-document"><a class="anchor" href="#simple-document"></a>2.1. Simple Document</h3>
<div class="paragraph">
<p>This document is used in <em>responses</em> that contain no data, just a boolean status and a message. On success, it might
look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>HTTP/1.1 200 OK
Content-Type: application/json</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "success" : true,
   "message" : "all is good"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>On failure, it might look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>HTTP/1.1 400 Bad request
Content-Type: application/json</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "success" : false,
   "message" : "Unrecognized property in request"
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Collection_Document"><a class="anchor" href="#Collection_Document"></a>2.2. Collection Document</h3>
<div class="paragraph">
<p>This document is used in <em>responses</em> that return the data from the server. This is the main representation of data in Agrest.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>HTTP/1.1 200 OK
Content-Type: application/json</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "data" : [
      { "id" : 5, "name": "A" },
      { "id" : 8, "name": "B" }
   ],
   "total" : 2
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>data</code> array contains entity objects. Implicit entity model defines what
attributes and relationships (collectively - "properties") each object has. A subset of
properties showing in the collection document is a defined by a combination of
server-side constraints and client request control parameters. Each object in the data
array may contain related objects, those in turn may contain their related objects, with
no limit on the depth of nesting.</p>
</div>
<div class="paragraph">
<p><code>total</code> is a number of objects one would see in the collection if there was no pagination. If
<a href="#Pagination">pagination is in use</a>, the total may be greater than the number of visible objects in the "data" array.
Otherwise, it is equal to the size of "data".</p>
</div>
</div>
<div class="sect2">
<h3 id="update-document"><a class="anchor" href="#update-document"></a>2.3. Update Document</h3>
<div class="paragraph">
<p>Update Document is sent in a <em>request</em> body from the client to the server to modify an entity collection.
It is a Collection document stripped down to its data section. There are two flavors - a single object and an array of
objects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{ "id" : 5, "name": "X" }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">[
   { "id" : 5, "name": "X" },
   { "id" : 8, "name": "Y" }
]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dates-and-times"><a class="anchor" href="#dates-and-times"></a>3. Dates and Times</h2>
<div class="sectionbody">
<div class="paragraph">
<p>JSON doesn&#8217;t have data types for either date or time. Both are represented as strings.
Server and client must ensure that date/time strings are in
<a href="https://en.wikipedia.org/wiki/ISO_8601">ISO 8601 format</a>. E.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>2015-04-19T11:08:53Z
2015-04-10T11:08
2015-04-19</code></pre>
</div>
</div>
<div class="paragraph">
<p>Developers should not assume that the server is in the same time zone as the browser.
All timezone-aware expressions should contain time zone offset or "Z" suffix (for "Zulu" time).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="control-parameters"><a class="anchor" href="#control-parameters"></a>4. Control Parameters</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Control parameters are passed as query parameters in the request URL. Within a given request, they are applied
by the server to a response <a href="#Collection_Document">Collection Document</a>. They allow the client to dynamically shape
responses. The client can decide which object properties to include, how to sort and filter data, etc.</p>
</div>
<div class="paragraph">
<p>The parameters are normally used in GET requests, however POST/PUT can also return Collection Documents, so most of
them are also applicable to POST/PUT.</p>
</div>
<div class="sect2">
<h3 id="exp"><a class="anchor" href="#exp"></a>4.1. exp</h3>
<div class="paragraph">
<p><code>exp</code> parameter is used to filter objects in the response collection.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
"exp" parameter was first introduced in Agrest 4.1. Previously it was called "cayenneExp".
Both are synonymous. "cayenneExp" is still supported, though is considered deprecated.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A condition expression used to filter the response objects. Expression follow syntax of the
<a href="https://cayenne.apache.org/docs/4.0/cayenne-guide/expressions.html">Apache Cayenne expressions</a>.
An implicit "root" for the property paths is the request entity, (unless "exp" is used within
an "include" JSON, in which case the root is that related entity).</p>
</div>
<div class="paragraph">
<p>Example 1: Filtering on a single property.</p>
</div>
<div class="paragraph">
<p><code>exp=vhost='agrest.io'</code></p>
</div>
<div class="paragraph">
<p>Example 2: Filtering using outer join (the "+" sign is notation for "outer").</p>
</div>
<div class="paragraph">
<p><code>exp=articles+ = null</code></p>
</div>
<div class="paragraph">
<p>Example 3: Filtering with parameters using positional bindings.</p>
</div>
<div class="paragraph">
<p><code>exp=["articles.body like $b","%Agrest%"]</code></p>
</div>
<div class="paragraph">
<p>Example 4: Filtering with parameters using named bindings.</p>
</div>
<div class="paragraph">
<p><code>exp={ "exp" : "articles.body like $b", "params":{"b":"%Agrest%"}}</code></p>
</div>
</div>
<div class="sect2">
<h3 id="sort-dir"><a class="anchor" href="#sort-dir"></a>4.2. sort / dir</h3>
<div class="paragraph">
<p><code>sort</code> and <code>dir</code> parameters are used to order objects in the response collection.</p>
</div>
<div class="paragraph">
<p>Example 1: Sort on a single property.</p>
</div>
<div class="paragraph">
<p><code>sort=vhost</code></p>
</div>
<div class="paragraph">
<p>Example 2: Sort descending on a property.</p>
</div>
<div class="paragraph">
<p><code>sort=id&amp;dir=DESC</code></p>
</div>
<div class="paragraph">
<p><code>dir</code> can be one of <code>ASC</code> (default), <code>DESC</code>, <code>ASC_CI</code> (for case-insensitive asending ordering), <code>DESC_CI</code> (for case-insensitive descending ordering)</p>
</div>
<div class="paragraph">
<p>Example 3: Same as 2, but sort is a JSON object.</p>
</div>
<div class="paragraph">
<p><code>sort={"property":"vhost","direction":"DESC"}</code></p>
</div>
<div class="paragraph">
<p><code>direction</code> takes the same values as <code>dir</code> above - <code>ASC</code> (implied default), <code>DESC</code>, <code>ASC_CI</code>, <code>DESC_CI</code></p>
</div>
<div class="paragraph">
<p>Example 4: Multiple sortings as a single JSON structure.</p>
</div>
<div class="paragraph">
<p><code>sort=[{"property":"name"},"property":"vhost","direction":"DESC"}]</code></p>
</div>
</div>
<div class="sect2">
<h3 id="Pagination"><a class="anchor" href="#Pagination"></a>4.3. start / limit</h3>
<div class="paragraph">
<p><code>start</code> and <code>limit</code> parameters are used to implement client-controlled pagination of the response collection.
They are used together or separately to request a range of objects in a bigger collection.</p>
</div>
<div class="paragraph">
<p><code>start</code> is an offset within the "data" array. All the objects below this offset are discarded from the collection.
Default <code>start</code> is 0.</p>
</div>
<div class="paragraph">
<p><code>limit</code> is a maximum number of objects in the collection "data". Default is no limit.</p>
</div>
<div class="paragraph">
<p><code>limit</code> is applied after <code>start</code>. So for a collection with a total of 10 objects,
<code>?start=2&amp;limit=5</code> would result in objects 2 through 6 returned from the server. Returned Collection "total" would still be 10.</p>
</div>
</div>
<div class="sect2">
<h3 id="mapby"><a class="anchor" href="#mapby"></a>4.4. mapBy</h3>
<div class="paragraph">
<p><code>mapBy</code> parameter is used to reshape the <code>data</code> collection from a list of objects to a map of lists, keyed by some
property. E.g. consider a typical list response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
"data" : [
    { "title" : "Agrest mapBy",  "body" : "mapBy is used ..", "publishedOn" : "6 July, 2018" },
    { "title" : "Other Tech News",  "body" : "Java community ..", "publishedOn" : "8 October, 2017" },
    { "title" : "Introducing Agrest",  "body" : "Agrest is a ..", "publishedOn" : "6 July, 2018" }
  ],
  "total":3
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using <code>mapBy</code> it can be transformed to a map:</p>
</div>
<div class="paragraph">
<p><code>mapBy=publishedOn</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
"data" : {
    "8 October, 2017" : [
        { "title" : "Other Tech News",  "body" : "Java community …", "publishedOn" : "8 October, 2017" }
    ],
    "6 July, 2018" : [
        { "title" : "Agrest mapBy",  "body" : "mapBy is used …", "publishedOn" : "6 July, 2018" },
        { "title" : "Introducing Agrest",  "body" : "Agrest is a …", "publishedOn" : "6 July, 2018" }
    ]
  },
  "total" : 3
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="include-exclude"><a class="anchor" href="#include-exclude"></a>4.5. include / exclude</h3>
<div class="paragraph">
<p><code>include</code> and <code>exclude</code> parameters are used to recursively shape individual objects in the response collection. Model
entities may have "simple" properties (attributes) and properties that point to
related entities (relationships). By default, Collection Document contains entity
representation that includes its "id", all of its attributes, and none of the
relationships. "include" and "exclude" parameters allow the client to request a specific
subset of entity properties, including related entities. Some examples are given below,
showing include/exclude parameters and resulting entity contents.</p>
</div>
<div class="paragraph">
<p>Example 1: Include default properties (all entity attributes) minus "vhost" attribute.</p>
</div>
<div class="paragraph">
<p><code>exclude=vhost</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{ "id" : 45, "name" : "Agrest Site" }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example 2: Exclude all properties, but "id".</p>
</div>
<div class="paragraph">
<p><code>include=id</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{ "id" : 45 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example 3: Multiple includes, one of them points to attributes of related entity.</p>
</div>
<div class="paragraph">
<p><code>include=id&amp;include=articles.title</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "id" : 45,
   "articles" : [
      { "title" : "Agrest Includes" },
      { "title" : "Other Tech News" },
      { "title" : "Introducing Agrest" }
   ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example 4: Advanced include. Include specification can itself be a JSON object and
contain <code>"exp"</code>, <code>"sort"</code>, <code>"start"</code> and <code>"limit"</code> keys shaping up a collection
of related objects for each root object.</p>
</div>
<div class="paragraph">
<p><code>include={"path":"articles","exp":"title like '%Agrest%'","sort":"title"}&amp;include=articles.title</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "id" : 45,
   "articles" : [
      { "title" : "Introducing Agrest" },
      { "title" : "Agrest Includes" }
   ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example 5: Related objects as a map. Here we&#8217;ll map article bodies by title.</p>
</div>
<div class="paragraph">
<p><code>include={"path":"articles","mapBy":"title"}&amp;include=articles.body</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "articles" : {
      "Introducing Agrest" : { "body" : "Agrest is a .." },
      "Agrest Includes" : { "body" : "Includes are .." }
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example 6: Include and Exclude parameters have ability to take an array of values:</p>
</div>
<div class="paragraph">
<p><code>include=["id","name"]</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{ "id" : 45, "name" : "Agrest Site" }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example 7: The array can contain both the simple include and the advanced include values</p>
</div>
<div class="paragraph">
<p><code>include=["id","articles.title",{"path":"articles","exp":"title like '%Agrest%'"}]</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "id" : 45,
   "articles" : [
      { "title" : "Introducing Agrest" },
      { "title" : "Agrest Includes" }
   ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example 8: Attributes of a related entity can be presented as an inner array in JSON format:</p>
</div>
<div class="paragraph">
<p><code>include=["id","name",{"articles":["title","body"]}]</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "id" : 45,
   "name" : "Agrest Site",
   "articles" : [
      { "title" : "Introducing Agrest", "body" : "Agrest is a .." },
      { "title" : "Agrest Includes", "body" : "Includes are .." }
   ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example 9: The related entity can be specified as a path value:</p>
</div>
<div class="paragraph">
<p><code>include=["id","name",{"articles.categories":["id","name"]}]</code></p>
</div>
<div class="paragraph">
<p>Example 10: The advanced include can contain the array of include values:</p>
</div>
<div class="paragraph">
<p><code>include={"path":"articles","sort":"title","include":["title",{"categories":["id","name"]}]}</code></p>
</div>
</div>
</div>
</div>
                </article>
            </div>

        </div>
    </div>


        <footer id="footer" class="pt-0 pb-3" style ="bottom: 0px; position: absolute; width: 100%;">
    <div class="container">
        <div class="row justify-content-center text-center">
            <div class="col-8 col-md-12">
                <p class="text-muted">&copy;  <span class="current-year">2018</span> ObjectStyle and other Agrest Developers.</p>
                <ul id="social-icons" class="list-unstyled list-inline  mb-0">
                    <li class="list-inline-item">
                        <a href="https://github.com/agrestio/agrest">
                            <img class="inline-svg" src="/images/fa/fab/github-brands.svg" alt="github logo"/>
                        </a>
                    </li>
                    <li class="list-inline-item">
                        <a href="https://twitter.com/AgrestProject">
                            <img class="inline-svg" src="/images/fa/fab/twitter-brands.svg" alt="twitter logo"/>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</footer>

    </body>
</html>